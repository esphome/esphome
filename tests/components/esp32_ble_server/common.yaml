esp32_ble_server:
  id: ble_server
  manufacturer_data: [0x72, 0x4, 0x00, 0x23]
  manufacturer: ESPHome
  model: Test
  services:
    - uuid: 2a24b789-7aab-4535-af3e-ee76a35cc42d
      advertise: false
      characteristics:
        - id: test_notify_characteristic
          uuid: cad48e28-7fbe-41cf-bae9-d77a6c233423
          read: true
          notify: true
          value: [0, 1, 2]
          descriptors:
            - uuid: cad48e28-7fbe-41cf-bae9-d77a6c111111
              value: 123.1
              byte_length: 100
    - uuid: 2a24b789-7a1b-4535-af3e-ee76a35cc42d
      advertise: false
      characteristics:
        - id: test_change_characteristic
          uuid: 2a24b789-7a1b-4535-af3e-ee76a35cc11d
          read: true
          value: "Initial"
          descriptors:
            - uuid: cad48e28-7fbe-41cf-bae9-d77a6c111111
              value: 0x12
        - uuid: 2a24b789-7a1b-4535-af3e-ee76a35cc12d
          write: true
          on_write:
            then:
              - lambda: |-
                  ESP_LOGD("BLE", "Received: %s", std::string(x.begin(), x.end()).c_str());
              - ble_server.characteristic.set_value:
                  id: test_change_characteristic
                  value: !lambda 'return ByteBuffer::wrap({0x00, 0x01, 0x02});'
              - ble_server.characteristic.notify:
                  id: test_notify_characteristic
